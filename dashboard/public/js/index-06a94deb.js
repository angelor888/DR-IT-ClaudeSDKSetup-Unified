import{u as re,r as w,j as e,h as je,b as Ne}from"./react-vendor-4efa36ba.js";import{u as Ie,a as pe,g as se,f as ge,b as ye,c as Ce,d as Ae,e as ke,h as Te,i as ze,j as De,k as Le,l as Pe}from"./customer.types-8a72a4df.js";import{a2 as m,ap as j,Q as t,h as C,aB as Ee,aC as We,aD as K,aE as Me,P as te,r as f,I as Fe,aF as Be,aG as Oe,ab as Je,p as y,j as E,T as ae,k as B,aH as be,aI as $e,aJ as ve,aK as Re,C as M,am as D,an as P,ao as T,aL as b,b as F,aM as Ue,F as V,aN as X,J as ie,d as H,S as Q,A as fe,aO as Ge,aP as He,aQ as Qe,aR as qe,D as we,K as Ve,O as Z,aS as oe,ag as Ke,aT as Ye,Z as le,as as ce,$ as de,W as he,a3 as q,aq as _e,g as Xe,X as xe,Y as R,q as U,aU as ue,L as G,aV as Ze,aW as es,aX as ss,ad as rs,ax as ns,n as ts,aY as as}from"./mui-core-7e03cde4.js";import{a7 as is}from"./data-grid-96170eaf.js";import{u as os,C as k}from"./forms-f7b38fbf.js";import{c as me,a as N,b as ls,o as cs}from"./index-c64a16ff.js";import"./charts-b91b7911.js";import"./redux-vendor-908b6ad6.js";import"./date-vendor-851aa985.js";import"./websocket-d9998155.js";const vs=()=>{const s=re(),[x,c]=w.useState({page:1,limit:25,sortBy:"updatedAt",sortOrder:"desc"}),[u,g]=w.useState(""),[I,L]=w.useState(null),[h,S]=w.useState(null),{data:d,isLoading:n,isFetching:o}=Ie(x),[A]=pe(),l=w.useCallback(r=>{g(r.target.value)},[]),W=w.useCallback(()=>{c(r=>({...r,search:u,page:1}))},[u]),O=w.useCallback(async(r,v)=>{try{await A({id:r,isArchived:!v}).unwrap()}catch($){console.error("Failed to toggle archive status:",$)}},[A]),J=(r,v)=>{L(r.currentTarget),S(v)},i=()=>{L(null),S(null)},a=r=>{switch(r){case"synced":return e.jsx(E,{label:"Synced",color:"success",size:"small"});case"pending":return e.jsx(E,{label:"Pending",color:"warning",size:"small"});case"error":return e.jsx(E,{label:"Error",color:"error",size:"small"});default:return e.jsx(E,{label:"Not Synced",color:"default",size:"small"})}},p=[{field:"name",headerName:"Name",flex:1,minWidth:200,renderCell:r=>e.jsxs(m,{children:[e.jsx(t,{variant:"body2",fontWeight:"medium",children:se(r.row)}),r.row.companyName&&r.row.firstName&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:[r.row.firstName," ",r.row.lastName]})]})},{field:"email",headerName:"Email",width:200},{field:"phone",headerName:"Phone",width:150},{field:"address",headerName:"Address",flex:1,minWidth:250,renderCell:r=>e.jsx(t,{variant:"body2",noWrap:!0,children:ge(r.row.address)})},{field:"jobberSyncStatus",headerName:"Sync Status",width:120,renderCell:r=>a(r.row.jobberSyncStatus)},{field:"tags",headerName:"Tags",width:200,renderCell:r=>{var v;return e.jsx(j,{direction:"row",spacing:.5,children:(v=r.row.tags)==null?void 0:v.map(($,Y)=>e.jsx(E,{label:$,size:"small",variant:"outlined"},Y))})}},{field:"actions",headerName:"Actions",width:150,sortable:!1,renderCell:r=>e.jsxs(j,{direction:"row",spacing:1,children:[e.jsx(ae,{title:"Edit",children:e.jsx(B,{size:"small",onClick:()=>s(`/customers/${r.row.id}/edit`),children:e.jsx(be,{fontSize:"small"})})}),e.jsx(ae,{title:r.row.isArchived?"Unarchive":"Archive",children:e.jsx(B,{size:"small",onClick:()=>O(r.row.id,r.row.isArchived),children:r.row.isArchived?e.jsx($e,{fontSize:"small"}):e.jsx(ve,{fontSize:"small"})})}),e.jsx(B,{size:"small",onClick:v=>J(v,r.row.id),children:e.jsx(Re,{fontSize:"small"})})]})}];return e.jsxs(m,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(t,{variant:"h4",component:"h1",children:"Customers"}),e.jsxs(j,{direction:"row",spacing:2,children:[e.jsx(C,{startIcon:e.jsx(Ee,{}),variant:"outlined",onClick:()=>s("/customers/import"),children:"Import"}),e.jsx(C,{startIcon:e.jsx(We,{}),variant:"outlined",onClick:()=>s("/customers/export"),children:"Export"}),e.jsx(C,{startIcon:e.jsx(K,{}),variant:"outlined",onClick:()=>s("/customers/sync"),children:"Sync"}),e.jsx(C,{startIcon:e.jsx(Me,{}),variant:"contained",onClick:()=>s("/customers/new"),children:"Add Customer"})]})]}),e.jsx(te,{sx:{mb:2,p:2},children:e.jsxs(j,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(f,{size:"small",placeholder:"Search customers...",value:u,onChange:l,onKeyPress:r=>r.key==="Enter"&&W(),InputProps:{startAdornment:e.jsx(Fe,{position:"start",children:e.jsx(Be,{})})},sx:{flexGrow:1,maxWidth:400}}),e.jsx(C,{startIcon:e.jsx(Oe,{}),variant:"outlined",size:"small",onClick:()=>s("/customers/filters"),children:"Filters"})]})}),e.jsx(te,{sx:{flex:1,display:"flex",flexDirection:"column"},children:e.jsx(is,{rows:(d==null?void 0:d.customers)||[],columns:p,rowCount:(d==null?void 0:d.total)||0,loading:n||o,pageSizeOptions:[10,25,50,100],paginationModel:{page:x.page?x.page-1:0,pageSize:x.limit||25},onPaginationModelChange:r=>{c(v=>({...v,page:r.page+1,limit:r.pageSize}))},onSortModelChange:r=>{r.length>0&&c(v=>({...v,sortBy:r[0].field,sortOrder:r[0].sort||"asc"}))},disableRowSelectionOnClick:!0,onRowClick:r=>s(`/customers/${r.row.id}`),sx:{"& .MuiDataGrid-row":{cursor:"pointer"}}})}),e.jsxs(Je,{anchorEl:I,open:!!I,onClose:i,children:[e.jsx(y,{onClick:()=>{s(`/customers/${h}`),i()},children:"View Details"}),e.jsx(y,{onClick:()=>{s(`/customers/${h}/jobs`),i()},children:"View Jobs"}),e.jsx(y,{onClick:()=>{s(`/customers/${h}/sync`),i()},children:"Sync with Jobber"})]})]})},ds=me({firstName:N().optional(),lastName:N().optional(),companyName:N().optional(),email:N().email("Invalid email address").required("Email is required"),phone:N().optional().matches(/^[\d\s\-\(\)\+]*$/,"Invalid phone number"),address:me({street1:N().optional(),street2:N().optional(),city:N().optional(),province:N().optional(),postalCode:N().optional(),country:N().optional().default("Canada")}).optional(),tags:ls().of(N().required()).optional(),notes:N().optional(),preferredContactMethod:N().oneOf(["email","phone","text"]).optional()}).test("name-required","Either company name or first name is required",function(s){return!!(s.companyName||s.firstName)}),fs=()=>{const s=re(),{id:x}=je(),c=!!x,{data:u,isLoading:g}=ye(x,{skip:!c}),{data:I}=Ce(),[L,{isLoading:h}]=Ae(),[S,{isLoading:d}]=ke(),{control:n,handleSubmit:o,reset:A,formState:{errors:l,isDirty:W}}=os({resolver:cs(ds),defaultValues:{firstName:"",lastName:"",companyName:"",email:"",phone:"",address:{street1:"",street2:"",city:"",province:"",postalCode:"",country:"Canada"},tags:[],notes:"",preferredContactMethod:"email"}});w.useEffect(()=>{u&&c&&A({firstName:u.firstName||"",lastName:u.lastName||"",companyName:u.companyName||"",email:u.email||"",phone:u.phone||"",address:u.address||{street1:"",street2:"",city:"",province:"",postalCode:"",country:"Canada"},tags:u.tags||[],notes:u.notes||"",preferredContactMethod:u.preferredContactMethod||"email"})},[u,c,A]);const O=async i=>{try{c?await S({id:x,data:i}).unwrap():await L(i).unwrap(),s("/customers")}catch(a){console.error("Failed to save customer:",a)}},J=[{code:"AB",name:"Alberta"},{code:"BC",name:"British Columbia"},{code:"MB",name:"Manitoba"},{code:"NB",name:"New Brunswick"},{code:"NL",name:"Newfoundland and Labrador"},{code:"NS",name:"Nova Scotia"},{code:"NT",name:"Northwest Territories"},{code:"NU",name:"Nunavut"},{code:"ON",name:"Ontario"},{code:"PE",name:"Prince Edward Island"},{code:"QC",name:"Quebec"},{code:"SK",name:"Saskatchewan"},{code:"YT",name:"Yukon"}];return g?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,children:e.jsx(M,{})}):e.jsxs(m,{children:[e.jsx(t,{variant:"h4",component:"h1",gutterBottom:!0,children:c?"Edit Customer":"Add New Customer"}),e.jsx("form",{onSubmit:o(O),children:e.jsxs(j,{spacing:3,children:[e.jsxs(D,{children:[e.jsx(P,{title:"Basic Information"}),e.jsx(T,{children:e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{size:12,children:e.jsx(k,{name:"companyName",control:n,render:({field:i})=>{var a;return e.jsx(f,{...i,fullWidth:!0,label:"Company Name",error:!!l.companyName,helperText:(a=l.companyName)==null?void 0:a.message})}})}),e.jsx(b,{size:{xs:12,sm:6},children:e.jsx(k,{name:"firstName",control:n,render:({field:i})=>{var a;return e.jsx(f,{...i,fullWidth:!0,label:"First Name",error:!!l.firstName,helperText:(a=l.firstName)==null?void 0:a.message})}})}),e.jsx(b,{size:{xs:12,sm:6},children:e.jsx(k,{name:"lastName",control:n,render:({field:i})=>{var a;return e.jsx(f,{...i,fullWidth:!0,label:"Last Name",error:!!l.lastName,helperText:(a=l.lastName)==null?void 0:a.message})}})})]})})]}),e.jsxs(D,{children:[e.jsx(P,{title:"Contact Information"}),e.jsx(T,{children:e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{size:{xs:12,sm:6},children:e.jsx(k,{name:"email",control:n,render:({field:i})=>{var a;return e.jsx(f,{...i,fullWidth:!0,label:"Email",type:"email",error:!!l.email,helperText:(a=l.email)==null?void 0:a.message})}})}),e.jsx(b,{size:{xs:12,sm:6},children:e.jsx(k,{name:"phone",control:n,render:({field:i})=>{var a;return e.jsx(f,{...i,fullWidth:!0,label:"Phone",error:!!l.phone,helperText:(a=l.phone)==null?void 0:a.message})}})}),e.jsx(b,{size:12,children:e.jsx(k,{name:"preferredContactMethod",control:n,render:({field:i})=>e.jsxs(F,{children:[e.jsxs(Ue,{...i,row:!0,children:[e.jsx(V,{value:"email",control:e.jsx(X,{}),label:"Email"}),e.jsx(V,{value:"phone",control:e.jsx(X,{}),label:"Phone"}),e.jsx(V,{value:"text",control:e.jsx(X,{}),label:"Text"})]}),e.jsx(ie,{children:"Preferred Contact Method"})]})})})]})})]}),e.jsxs(D,{children:[e.jsx(P,{title:"Address"}),e.jsx(T,{children:e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{size:12,children:e.jsx(k,{name:"address.street1",control:n,render:({field:i})=>{var a,p,r;return e.jsx(f,{...i,fullWidth:!0,label:"Street Address",error:!!((a=l.address)!=null&&a.street1),helperText:(r=(p=l.address)==null?void 0:p.street1)==null?void 0:r.message})}})}),e.jsx(b,{size:12,children:e.jsx(k,{name:"address.street2",control:n,render:({field:i})=>e.jsx(f,{...i,fullWidth:!0,label:"Apartment, Suite, etc."})})}),e.jsx(b,{size:{xs:12,sm:6},children:e.jsx(k,{name:"address.city",control:n,render:({field:i})=>{var a,p,r;return e.jsx(f,{...i,fullWidth:!0,label:"City",error:!!((a=l.address)!=null&&a.city),helperText:(r=(p=l.address)==null?void 0:p.city)==null?void 0:r.message})}})}),e.jsx(b,{size:{xs:12,sm:3},children:e.jsx(k,{name:"address.province",control:n,render:({field:i})=>{var a,p;return e.jsxs(F,{fullWidth:!0,error:!!((a=l.address)!=null&&a.province),children:[e.jsx(H,{children:"Province"}),e.jsxs(Q,{...i,label:"Province",children:[e.jsx(y,{value:"",children:"Select Province"}),J.map(r=>e.jsx(y,{value:r.code,children:r.name},r.code))]}),((p=l.address)==null?void 0:p.province)&&e.jsx(ie,{children:l.address.province.message})]})}})}),e.jsx(b,{size:{xs:12,sm:3},children:e.jsx(k,{name:"address.postalCode",control:n,render:({field:i})=>{var a,p,r;return e.jsx(f,{...i,fullWidth:!0,label:"Postal Code",error:!!((a=l.address)!=null&&a.postalCode),helperText:(r=(p=l.address)==null?void 0:p.postalCode)==null?void 0:r.message})}})})]})})]}),e.jsxs(D,{children:[e.jsx(P,{title:"Additional Information"}),e.jsx(T,{children:e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{size:12,children:e.jsx(k,{name:"tags",control:n,render:({field:i})=>e.jsx(fe,{...i,multiple:!0,options:I||[],freeSolo:!0,onChange:(a,p)=>i.onChange(p),renderTags:(a,p)=>a.map((r,v)=>w.createElement(E,{variant:"outlined",label:r,...p({index:v}),key:r})),renderInput:a=>e.jsx(f,{...a,label:"Tags",placeholder:"Add tags",helperText:"Press Enter to add custom tags"})})})}),e.jsx(b,{size:12,children:e.jsx(k,{name:"notes",control:n,render:({field:i})=>{var a;return e.jsx(f,{...i,fullWidth:!0,multiline:!0,rows:4,label:"Notes",error:!!l.notes,helperText:(a=l.notes)==null?void 0:a.message})}})})]})})]}),e.jsxs(j,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(C,{variant:"outlined",onClick:()=>s("/customers"),disabled:h||d,children:"Cancel"}),e.jsx(C,{type:"submit",variant:"contained",disabled:!W||h||d,children:h||d?e.jsx(M,{size:24}):c?"Update Customer":"Create Customer"})]})]})})]})},ee=({children:s,value:x,index:c,...u})=>e.jsx("div",{role:"tabpanel",hidden:x!==c,id:`customer-tabpanel-${c}`,"aria-labelledby":`customer-tab-${c}`,...u,children:x===c&&e.jsx(m,{sx:{pt:3},children:s})}),ws=()=>{var ne;const s=re(),{id:x}=je(),[c,u]=w.useState(0),[g,I]=w.useState(!1),[L,h]=w.useState(!1),[S,d]=w.useState(""),{data:n,isLoading:o}=ye(x),[A,{isLoading:l}]=Te(),[W,{isLoading:O}]=pe(),[J,{isLoading:i}]=ze(),[a,{isLoading:p}]=De(),r=async()=>{try{await A(x).unwrap(),s("/customers")}catch(z){console.error("Failed to delete customer:",z)}},v=async()=>{if(n)try{await W({id:x,isArchived:!n.isArchived}).unwrap()}catch(z){console.error("Failed to archive customer:",z)}},$=async()=>{try{await J(x).unwrap()}catch(z){console.error("Failed to sync customer:",z)}},Y=async()=>{if(S.trim())try{await a({customerId:x,note:S}).unwrap(),d(""),h(!1)}catch(z){console.error("Failed to add note:",z)}};if(o||!n)return e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,children:e.jsx(M,{})});const Se=()=>{switch(n.jobberSyncStatus){case"synced":return e.jsxs(q,{severity:"success",sx:{mb:2},children:["Successfully synced with Jobber on ",new Date(n.lastJobberSync).toLocaleString()]});case"error":return e.jsxs(q,{severity:"error",sx:{mb:2},children:["Sync error: ",n.jobberSyncError]});case"pending":return e.jsx(q,{severity:"warning",sx:{mb:2},children:"Sync pending..."});default:return null}};return e.jsxs(m,{children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(t,{variant:"h4",component:"h1",children:se(n)}),e.jsxs(j,{direction:"row",spacing:1,children:[e.jsx(C,{startIcon:i?e.jsx(M,{size:20}):e.jsx(K,{}),variant:"outlined",onClick:$,disabled:i,children:"Sync with Jobber"}),e.jsx(C,{startIcon:e.jsx(be,{}),variant:"contained",onClick:()=>s(`/customers/${x}/edit`),children:"Edit"}),e.jsx(B,{onClick:v,disabled:O,color:n.isArchived?"primary":"default",children:e.jsx(ve,{})}),e.jsx(B,{onClick:()=>I(!0),color:"error",children:e.jsx(Ge,{})})]})]}),Se(),e.jsxs(j,{direction:{xs:"column",md:"row"},spacing:3,children:[e.jsxs(m,{sx:{flex:{md:1}},children:[e.jsxs(D,{children:[e.jsx(P,{title:"Contact Information"}),e.jsx(T,{children:e.jsxs(j,{spacing:2,children:[n.email&&e.jsxs(m,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(He,{fontSize:"small",color:"action"}),e.jsx(t,{variant:"body2",children:n.email})]}),n.phone&&e.jsxs(m,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Qe,{fontSize:"small",color:"action"}),e.jsx(t,{variant:"body2",children:n.phone})]}),n.address&&e.jsxs(m,{display:"flex",alignItems:"flex-start",gap:1,children:[e.jsx(qe,{fontSize:"small",color:"action"}),e.jsx(t,{variant:"body2",children:ge(n.address)})]}),e.jsx(we,{}),e.jsxs(m,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Preferred Contact Method"}),e.jsx(t,{variant:"body2",children:n.preferredContactMethod||"Not specified"})]})]})})]}),e.jsxs(D,{sx:{mt:2},children:[e.jsx(P,{title:"Tags"}),e.jsx(T,{children:e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",children:(ne=n.tags)!=null&&ne.length?n.tags.map((z,_)=>e.jsx(E,{label:z,size:"small"},_)):e.jsx(t,{variant:"body2",color:"text.secondary",children:"No tags"})})})]}),e.jsxs(D,{sx:{mt:2},children:[e.jsx(P,{title:"Metadata"}),e.jsx(T,{children:e.jsxs(j,{spacing:1,children:[e.jsxs(m,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Customer ID"}),e.jsx(t,{variant:"body2",children:n.id})]}),n.jobberId&&e.jsxs(m,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Jobber ID"}),e.jsx(t,{variant:"body2",children:n.jobberId})]}),e.jsxs(m,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Created"}),e.jsx(t,{variant:"body2",children:new Date(n.createdAt).toLocaleDateString()})]}),e.jsxs(m,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Last Updated"}),e.jsx(t,{variant:"body2",children:new Date(n.updatedAt).toLocaleDateString()})]})]})})]})]}),e.jsx(m,{sx:{flex:{md:2}},children:e.jsxs(D,{children:[e.jsxs(Ve,{value:c,onChange:(z,_)=>u(_),"aria-label":"customer detail tabs",children:[e.jsx(Z,{icon:e.jsx(oe,{}),label:"Notes"}),e.jsx(Z,{icon:e.jsx(Ke,{}),label:"Jobs"}),e.jsx(Z,{icon:e.jsx(Ye,{}),label:"History"})]}),e.jsx(ee,{value:c,index:0,children:e.jsx(T,{children:e.jsxs(j,{spacing:2,children:[e.jsx(C,{variant:"outlined",startIcon:e.jsx(oe,{}),onClick:()=>h(!0),children:"Add Note"}),n.notes?e.jsx(t,{variant:"body2",whiteSpace:"pre-wrap",children:n.notes}):e.jsx(t,{variant:"body2",color:"text.secondary",children:"No notes available"})]})})}),e.jsx(ee,{value:c,index:1,children:e.jsx(T,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Jobs functionality will be implemented in the next phase"})})}),e.jsx(ee,{value:c,index:2,children:e.jsx(T,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"History tracking will be implemented in the next phase"})})})]})})]}),e.jsxs(le,{open:g,onClose:()=>I(!1),children:[e.jsx(ce,{children:"Delete Customer"}),e.jsx(de,{children:e.jsxs(t,{children:["Are you sure you want to delete ",se(n),"? This action cannot be undone."]})}),e.jsxs(he,{children:[e.jsx(C,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(C,{onClick:r,color:"error",variant:"contained",disabled:l,children:l?e.jsx(M,{size:24}):"Delete"})]})]}),e.jsxs(le,{open:L,onClose:()=>h(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ce,{children:"Add Note"}),e.jsx(de,{children:e.jsx(f,{autoFocus:!0,multiline:!0,rows:4,fullWidth:!0,value:S,onChange:z=>d(z.target.value),placeholder:"Enter your note here...",sx:{mt:2}})}),e.jsxs(he,{children:[e.jsx(C,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(C,{onClick:Y,variant:"contained",disabled:p||!S.trim(),children:p?e.jsx(M,{size:24}):"Add Note"})]})]})]})},Ss=()=>{var S;const{data:s,isLoading:x,refetch:c}=Le(void 0,{pollingInterval:5e3}),[u,{isLoading:g}]=Pe(),I=async()=>{try{await u().unwrap(),c()}catch(d){console.error("Failed to start sync:",d)}},L=()=>{if(!s)return 0;const{totalCustomers:d,syncedCustomers:n}=s;return d===0?0:n/d*100},h=d=>{switch(d){case"synced":return e.jsx(ss,{color:"success"});case"error":return e.jsx(ue,{color:"error"});case"pending":return e.jsx(es,{color:"warning"});default:return e.jsx(Ze,{color:"disabled"})}};return x?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,children:e.jsx(t,{children:"Loading sync status..."})}):e.jsxs(m,{children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(t,{variant:"h4",component:"h1",children:"Jobber Sync Status"}),e.jsxs(j,{direction:"row",spacing:2,children:[e.jsx(C,{startIcon:e.jsx(_e,{}),variant:"outlined",onClick:()=>c(),children:"Refresh"}),e.jsx(C,{startIcon:g?e.jsx(K,{className:"animate-spin"}):e.jsx(K,{}),variant:"contained",onClick:I,disabled:g||(s==null?void 0:s.isRunning),children:g||s!=null&&s.isRunning?"Syncing...":"Sync All Customers"})]})]}),(s==null?void 0:s.isRunning)&&e.jsx(q,{severity:"info",sx:{mb:3},children:e.jsx(t,{variant:"body2",children:"Sync is currently running. This page will automatically update with progress."})}),e.jsxs(j,{spacing:3,children:[e.jsxs(D,{children:[e.jsx(P,{title:"Sync Overview"}),e.jsx(T,{children:e.jsxs(j,{spacing:3,children:[e.jsxs(m,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Overall Progress"}),e.jsx(Xe,{variant:"determinate",value:L(),sx:{height:8,borderRadius:4}}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[(s==null?void 0:s.syncedCustomers)||0," of ",(s==null?void 0:s.totalCustomers)||0," customers processed"]})]}),e.jsxs(j,{direction:"row",spacing:4,children:[e.jsxs(m,{textAlign:"center",children:[e.jsx(t,{variant:"h4",color:"success.main",children:(s==null?void 0:s.syncedCustomers)||0}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Synced"})]}),e.jsxs(m,{textAlign:"center",children:[e.jsx(t,{variant:"h4",color:"warning.main",children:(s==null?void 0:s.pendingCustomers)||0}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Pending"})]}),e.jsxs(m,{textAlign:"center",children:[e.jsx(t,{variant:"h4",color:"error.main",children:(s==null?void 0:s.errorCustomers)||0}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Errors"})]})]}),(s==null?void 0:s.lastSync)&&e.jsx(m,{children:e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Last sync completed: ",new Date(s.lastSync).toLocaleString()]})})]})})]}),(s==null?void 0:s.errors)&&s.errors.length>0&&e.jsxs(D,{children:[e.jsx(P,{title:"Sync Errors",action:e.jsx(E,{label:s.errors.length,color:"error",size:"small"})}),e.jsx(T,{children:e.jsx(xe,{children:(S=s.errors)==null?void 0:S.map((d,n)=>{var o;return e.jsxs(Ne.Fragment,{children:[e.jsxs(R,{alignItems:"flex-start",children:[e.jsx(U,{children:e.jsx(ue,{color:"error"})}),e.jsx(G,{primary:`Customer ID: ${d.customerId}`,secondary:e.jsxs(j,{spacing:1,children:[e.jsx(t,{variant:"body2",color:"error",children:d.error}),e.jsx(t,{variant:"caption",color:"text.secondary",children:new Date(d.timestamp).toLocaleString()})]})})]}),n<(((o=s.errors)==null?void 0:o.length)||0)-1&&e.jsx(we,{})]},n)})})})]}),e.jsxs(D,{children:[e.jsx(P,{title:"Sync Information"}),e.jsx(T,{children:e.jsxs(j,{spacing:2,children:[e.jsx(q,{severity:"info",children:e.jsx(t,{variant:"body2",children:"Customer sync pulls data from Jobber and updates local customer records. This includes contact information, addresses, and metadata."})}),e.jsxs(xe,{children:[e.jsxs(R,{children:[e.jsx(U,{children:h("synced")}),e.jsx(G,{primary:"Synced",secondary:"Customer data successfully synchronized with Jobber"})]}),e.jsxs(R,{children:[e.jsx(U,{children:h("pending")}),e.jsx(G,{primary:"Pending",secondary:"Customer is queued for synchronization"})]}),e.jsxs(R,{children:[e.jsx(U,{children:h("error")}),e.jsx(G,{primary:"Error",secondary:"Synchronization failed - check error details above"})]}),e.jsxs(R,{children:[e.jsx(U,{children:h("not_synced")}),e.jsx(G,{primary:"Not Synced",secondary:"Customer has not been synchronized with Jobber"})]})]})]})})]})]})]})},Ns=({open:s,onClose:x,filters:c,onFiltersChange:u})=>{const[g,I]=w.useState(c),{data:L}=Ce(),h=(o,A)=>{I(l=>({...l,[o]:A}))},S=()=>{u(g),x()},d=()=>{const o={page:1,limit:c.limit||25,sortBy:"updatedAt",sortOrder:"desc"};I(o),u(o)},n=["AB","BC","MB","NB","NL","NS","NT","NU","ON","PE","QC","SK","YT"];return e.jsx(rs,{anchor:"right",open:s,onClose:x,PaperProps:{sx:{width:400,p:3}},children:e.jsxs(j,{spacing:3,children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(t,{variant:"h6",children:"Filter Customers"}),e.jsx(B,{onClick:x,edge:"end",children:e.jsx(ns,{})})]}),e.jsx(V,{control:e.jsx(ts,{checked:g.isArchived||!1,onChange:o=>h("isArchived",o.target.checked)}),label:"Show Archived Customers"}),e.jsxs(F,{fullWidth:!0,children:[e.jsx(H,{children:"Sync Status"}),e.jsxs(Q,{value:g.jobberSyncStatus||"",onChange:o=>h("jobberSyncStatus",o.target.value||void 0),label:"Sync Status",children:[e.jsx(y,{value:"",children:"All"}),e.jsx(y,{value:"synced",children:"Synced"}),e.jsx(y,{value:"pending",children:"Pending"}),e.jsx(y,{value:"error",children:"Error"}),e.jsx(y,{value:"not_synced",children:"Not Synced"})]})]}),e.jsx(fe,{multiple:!0,options:L||[],value:g.tags||[],onChange:(o,A)=>h("tags",A),renderTags:(o,A)=>o.map((l,W)=>w.createElement(E,{variant:"outlined",label:l,...A({index:W}),key:l})),renderInput:o=>e.jsx(f,{...o,label:"Tags",placeholder:"Select tags"})}),e.jsx(f,{fullWidth:!0,label:"City",value:g.city||"",onChange:o=>h("city",o.target.value||void 0)}),e.jsxs(F,{fullWidth:!0,children:[e.jsx(H,{children:"Province"}),e.jsxs(Q,{value:g.province||"",onChange:o=>h("province",o.target.value||void 0),label:"Province",children:[e.jsx(y,{value:"",children:"All"}),n.map(o=>e.jsx(y,{value:o,children:o},o))]})]}),e.jsxs(F,{fullWidth:!0,children:[e.jsx(H,{children:"Sort By"}),e.jsxs(Q,{value:g.sortBy||"updatedAt",onChange:o=>h("sortBy",o.target.value),label:"Sort By",children:[e.jsx(y,{value:"name",children:"Name"}),e.jsx(y,{value:"email",children:"Email"}),e.jsx(y,{value:"createdAt",children:"Created Date"}),e.jsx(y,{value:"updatedAt",children:"Updated Date"})]})]}),e.jsxs(F,{fullWidth:!0,children:[e.jsx(H,{children:"Sort Order"}),e.jsxs(Q,{value:g.sortOrder||"desc",onChange:o=>h("sortOrder",o.target.value),label:"Sort Order",children:[e.jsx(y,{value:"asc",children:"Ascending"}),e.jsx(y,{value:"desc",children:"Descending"})]})]}),e.jsxs(j,{direction:"row",spacing:2,sx:{mt:3},children:[e.jsx(C,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(as,{}),onClick:d,children:"Clear Filters"}),e.jsx(C,{fullWidth:!0,variant:"contained",onClick:S,children:"Apply Filters"})]})]})})};export{ws as CustomerDetail,Ns as CustomerFiltersDrawer,fs as CustomerForm,vs as CustomerList,Ss as CustomerSync};
//# sourceMappingURL=index-06a94deb.js.map
